% Copyright 2013 Barzan Mozafari
%
% Licensed under the Apache License, Version 2.0 (the "License");
% you may not use this file except in compliance with the License.
% You may obtain a copy of the License at
%
%     http://www.apache.org/licenses/LICENSE-2.0
%
% Unless required by applicable law or agreed to in writing, software
% distributed under the License is distributed on an "AS IS" BASIS,
% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
% See the License for the specific language governing permissions and
% limitations under the License.

countHeads = '"Tran1","Tran2","Tran3","Tran4","Tran5","Tran11","Tran22","Tran33","Tran44","Tran55","Tran12","Tran13","Tran14","Tran15","Tran23","Tran24","Tran25","Tran34","Tran35","Tran45","Tran1_2","Tran1_3","Tran1_4","Tran1_5","Tran2_1","Tran2_3","Tran2_4","Tran2_5","Tran3_1","Tran3_2","Tran3_4","Tran3_5","Tran4_1","Tran4_2","Tran4_3","Tran4_5","Tran5_1","Tran5_2","Tran5_3","Tran5_4"';
monitHeads = '"cpu_usr","cpu_sys","cpu_total","cpu_wai","cpu_hiq","cpu_siq","memory_used","memory_buff","memory_cach","memory_free","net_recv","net_send","dsk_read","dsk_writ","io_read","io_writ","swap_used","swap_free","paging_in","paging_out","virtual_majpf","virtual_minpf","virtual_alloc","virtual_free","filesystem_files","filesystem_inodes","interupts_33","interupts_79","interupts_80","interupts_81","interupts_82","interupts_83","interupts_84","interupts_85","interupts_86","system_int","system_csw","procs_run","procs_blk","procs_new","sda_util","Bytes_received","Bytes_sent","Com_commit","Com_delete","Com_insert","Com_rollback","Com_select","Com_update","Created_tmp_tables","Handler_commit","Handler_delete","Handler_read_key","Handler_read_next","Handler_read_prev","Handler_rollback","Handler_update","Handler_write","Innodb_buffer_pool_pages_data","Innodb_buffer_pool_pages_dirty","Innodb_buffer_pool_pages_flushed","Innodb_buffer_pool_pages_free","Innodb_buffer_pool_pages_misc","Innodb_buffer_pool_read_requests","Innodb_buffer_pool_reads","Innodb_buffer_pool_write_requests","Innodb_data_fsyncs","Innodb_data_pending_reads","Innodb_data_read","Innodb_data_reads","Innodb_data_writes","Innodb_data_written","Innodb_dblwr_pages_written","Innodb_dblwr_writes","Innodb_log_write_requests","Innodb_log_writes","Innodb_os_log_fsyncs","Innodb_os_log_written","Innodb_pages_created","Innodb_pages_read","Innodb_pages_written","Innodb_row_lock_current_waits","Innodb_row_lock_time","Innodb_row_lock_time_avg","Innodb_row_lock_time_max","Innodb_row_lock_waits","Innodb_rows_deleted","Innodb_rows_inserted","Innodb_rows_read","Innodb_rows_updated","Open_tables","Opened_tables","Queries","Questions","Select_range","Slow_queries","Table_locks_immediate","Threads_running","Uptime","Uptime_since_flush_status"';
monitLogHeads = '"lg_cpu_usr","lg_cpu_sys","lg_cpu_total","lg_cpu_wai","lg_cpu_hiq","lg_cpu_siq","lg_memory_used","lg_memory_buff","lg_memory_cach","lg_memory_free","lg_net_recv","lg_net_send","lg_dsk_read","lg_dsk_writ","lg_io_read","lg_io_writ","lg_swap_used","lg_swap_free","lg_paging_in","lg_paging_out","lg_virtual_majpf","lg_virtual_minpf","lg_virtual_alloc","lg_virtual_free","lg_filesystem_files","lg_filesystem_inodes","lg_interupts_33","lg_interupts_79","lg_interupts_80","lg_interupts_81","lg_interupts_82","lg_interupts_83","lg_interupts_84","lg_interupts_85","lg_interupts_86","lg_system_int","lg_system_csw","lg_procs_run","lg_procs_blk","lg_procs_new","lg_sda_util","lg_Bytes_received","lg_Bytes_sent","lg_Com_commit","lg_Com_delete","lg_Com_insert","lg_Com_rollback","lg_Com_select","lg_Com_update","lg_Created_tmp_tables","lg_Handler_commit","lg_Handler_delete","lg_Handler_read_key","lg_Handler_read_next","lg_Handler_read_prev","lg_Handler_rollback","lg_Handler_update","lg_Handler_write","lg_Innodb_buffer_pool_pages_data","lg_Innodb_buffer_pool_pages_dirty","lg_Innodb_buffer_pool_pages_flushed","lg_Innodb_buffer_pool_pages_free","lg_Innodb_buffer_pool_pages_misc","lg_Innodb_buffer_pool_read_requests","lg_Innodb_buffer_pool_reads","lg_Innodb_buffer_pool_write_requests","lg_Innodb_data_fsyncs","lg_Innodb_data_pending_reads","lg_Innodb_data_read","lg_Innodb_data_reads","lg_Innodb_data_writes","lg_Innodb_data_written","lg_Innodb_dblwr_pages_written","lg_Innodb_dblwr_writes","lg_Innodb_log_write_requests","lg_Innodb_log_writes","lg_Innodb_os_log_fsyncs","lg_Innodb_os_log_written","lg_Innodb_pages_created","lg_Innodb_pages_read","lg_Innodb_pages_written","lg_Innodb_row_lock_current_waits","lg_Innodb_row_lock_time","lg_Innodb_row_lock_time_avg","lg_Innodb_row_lock_time_max","lg_Innodb_row_lock_waits","lg_Innodb_rows_deleted","lg_Innodb_rows_inserted","lg_Innodb_rows_read","lg_Innodb_rows_updated","lg_Open_tables","lg_Opened_tables","lg_Queries","lg_Questions","lg_Select_range","lg_Slow_queries","lg_Table_locks_immediate","lg_Threads_running","lg_Uptime","lg_Uptime_since_flush_status"';
monitExpHeads = '"e_cpu_usr","e_cpu_sys","e_cpu_total","e_cpu_wai","e_cpu_hiq","e_cpu_siq","e_memory_used","e_memory_buff","e_memory_cach","e_memory_free","e_net_recv","e_net_send","e_dsk_read","e_dsk_writ","e_io_read","e_io_writ","e_swap_used","e_swap_free","e_paging_in","e_paging_out","e_virtual_majpf","e_virtual_minpf","e_virtual_alloc","e_virtual_free","e_filesystem_files","e_filesystem_inodes","e_interupts_33","e_interupts_79","e_interupts_80","e_interupts_81","e_interupts_82","e_interupts_83","e_interupts_84","e_interupts_85","e_interupts_86","e_system_int","e_system_csw","e_procs_run","e_procs_blk","e_procs_new","e_sda_util","e_Bytes_received","e_Bytes_sent","e_Com_commit","e_Com_delete","e_Com_insert","e_Com_rollback","e_Com_select","e_Com_update","e_Created_tmp_tables","e_Handler_commit","e_Handler_delete","e_Handler_read_key","e_Handler_read_next","e_Handler_read_prev","e_Handler_rollback","e_Handler_update","e_Handler_write","e_Innodb_buffer_pool_pages_data","e_Innodb_buffer_pool_pages_dirty","e_Innodb_buffer_pool_pages_flushed","e_Innodb_buffer_pool_pages_free","e_Innodb_buffer_pool_pages_misc","e_Innodb_buffer_pool_read_requests","e_Innodb_buffer_pool_reads","e_Innodb_buffer_pool_write_requests","e_Innodb_data_fsyncs","e_Innodb_data_pending_reads","e_Innodb_data_read","e_Innodb_data_reads","e_Innodb_data_writes","e_Innodb_data_written","e_Innodb_dblwr_pages_written","e_Innodb_dblwr_writes","e_Innodb_log_write_requests","e_Innodb_log_writes","e_Innodb_os_log_fsyncs","e_Innodb_os_log_written","e_Innodb_pages_created","e_Innodb_pages_read","e_Innodb_pages_written","e_Innodb_row_lock_current_waits","e_Innodb_row_lock_time","e_Innodb_row_lock_time_avg","e_Innodb_row_lock_time_max","e_Innodb_row_lock_waits","e_Innodb_rows_deleted","e_Innodb_rows_inserted","e_Innodb_rows_read","e_Innodb_rows_updated","e_Open_tables","e_Opened_tables","e_Queries","e_Questions","e_Select_range","e_Slow_queries","e_Table_locks_immediate","e_Threads_running","e_Uptime","e_Uptime_since_flush_status"';
monitSigHeads = '"s_cpu_usr","s_cpu_sys","s_cpu_total","s_cpu_wai","s_cpu_hiq","s_cpu_siq","s_memory_used","s_memory_buff","s_memory_cach","s_memory_free","s_net_recv","s_net_send","s_dsk_read","s_dsk_writ","s_io_read","s_io_writ","s_swap_used","s_swap_free","s_paging_in","s_paging_out","s_virtual_majpf","s_virtual_minpf","s_virtual_alloc","s_virtual_free","s_filesystem_files","s_filesystem_inodes","s_interupts_33","s_interupts_79","s_interupts_80","s_interupts_81","s_interupts_82","s_interupts_83","s_interupts_84","s_interupts_85","s_interupts_86","s_system_int","s_system_csw","s_procs_run","s_procs_blk","s_procs_new","s_sda_util","s_Bytes_received","s_Bytes_sent","s_Com_commit","s_Com_delete","s_Com_insert","s_Com_rollback","s_Com_select","s_Com_update","s_Created_tmp_tables","s_Handler_commit","s_Handler_delete","s_Handler_read_key","s_Handler_read_next","s_Handler_read_prev","s_Handler_rollback","s_Handler_update","s_Handler_write","s_Innodb_buffer_pool_pages_data","s_Innodb_buffer_pool_pages_dirty","s_Innodb_buffer_pool_pages_flushed","s_Innodb_buffer_pool_pages_free","s_Innodb_buffer_pool_pages_misc","s_Innodb_buffer_pool_read_requests","s_Innodb_buffer_pool_reads","s_Innodb_buffer_pool_write_requests","s_Innodb_data_fsyncs","s_Innodb_data_pending_reads","s_Innodb_data_read","s_Innodb_data_reads","s_Innodb_data_writes","s_Innodb_data_written","s_Innodb_dblwr_pages_written","s_Innodb_dblwr_writes","s_Innodb_log_write_requests","s_Innodb_log_writes","s_Innodb_os_log_fsyncs","s_Innodb_os_log_written","s_Innodb_pages_created","s_Innodb_pages_read","s_Innodb_pages_written","s_Innodb_row_lock_current_waits","s_Innodb_row_lock_time","s_Innodb_row_lock_time_avg","s_Innodb_row_lock_time_max","s_Innodb_row_lock_waits","s_Innodb_rows_deleted","s_Innodb_rows_inserted","s_Innodb_rows_read","s_Innodb_rows_updated","s_Open_tables","s_Opened_tables","s_Queries","s_Questions","s_Select_range","s_Slow_queries","s_Table_locks_immediate","s_Threads_running","s_Uptime","s_Uptime_since_flush_status"';
latencyHeads = '"Latency1"';


Cg = Callez1;
Mg = Mallez1;
Lg = Lallez1(:,1);

CBlown = [Cg ...
    Cg(:,1).*Cg(:,1) Cg(:,2).*Cg(:,2) Cg(:,3).*Cg(:,3) Cg(:,4).*Cg(:,4) Cg(:,5).*Cg(:,5) ...
    Cg(:,1).*Cg(:,2) Cg(:,1).*Cg(:,3) Cg(:,1).*Cg(:,4) Cg(:,1).*Cg(:,5) ...
    Cg(:,2).*Cg(:,3) Cg(:,2).*Cg(:,4) Cg(:,2).*Cg(:,5) ...
    Cg(:,3).*Cg(:,4) Cg(:,3).*Cg(:,5) ...
    Cg(:,4).*Cg(:,5) ...
    Cg(:,1)./Cg(:,2) Cg(:,1)./Cg(:,3) Cg(:,1)./Cg(:,4) Cg(:,1)./Cg(:,5) ...
    Cg(:,2)./Cg(:,1) Cg(:,2)./Cg(:,3) Cg(:,2)./Cg(:,4) Cg(:,2)./Cg(:,5) ...
    Cg(:,3)./Cg(:,1) Cg(:,3)./Cg(:,2) Cg(:,3)./Cg(:,4) Cg(:,3)./Cg(:,5) ...
    Cg(:,4)./Cg(:,1) Cg(:,4)./Cg(:,2) Cg(:,4)./Cg(:,3) Cg(:,4)./Cg(:,5) ...
    Cg(:,5)./Cg(:,1) Cg(:,5)./Cg(:,2) Cg(:,5)./Cg(:,3) Cg(:,5)./Cg(:,4) ...
    ];

MeAll = Mg;
maxAll = repmat(max(MeAll), [size(MeAll,1) 1]);
minAll = repmat(min(MeAll), [size(MeAll,1) 1]);
MeAll = 10.*(MeAll-minAll)./ (maxAll-minAll);
MeAll = exp(MeAll);
MeAll(MeAll==Inf) = NaN;
MeAll(MeAll==-Inf) = NaN;

MBlown = [Mg log(Mg) MeAll sigmf(Mg, [1 0])];

Blown = [CBlown MBlown Lg];

Blown(Blown==Inf) = NaN;
Blown(Blown==-Inf) = NaN;
maxB = repmat(max(Blown), [size(Blown,1) 1]);
minB = repmat(min(Blown), [size(Blown,1) 1]);
Blown = (Blown-minB)./ (maxB-minB);

system(horzcat('echo ',countHeads,',',monitHeads,',',monitLogHeads,',',monitExpHeads,',',monitSigHeads,',',latencyHeads,' > /Users/sina/expr5/weka/Blown.csv'));
dlmwrite('/Users/sina/expr5/weka/Blown.csv',Blown, 'delimiter',',','-append', 'precision', '%10.12f');        

CBlown67 = [Cg ...
    Cg(:,1).*Cg(:,2) Cg(:,1).*Cg(:,3) Cg(:,1).*Cg(:,4) Cg(:,1).*Cg(:,5) ...
    Cg(:,2).*Cg(:,3) Cg(:,2).*Cg(:,4) Cg(:,2).*Cg(:,5) ...
    Cg(:,3).*Cg(:,4) Cg(:,3).*Cg(:,5) ...
    Cg(:,4).*Cg(:,5) ...
    ];

Me67 = Mg(:, [Com_commit Com_update Innodb_dblwr_pages_written Innodb_pages_written]);
max67 = repmat(max(Me67), [size(Me67,1) 1]);
min67 = repmat(min(Me67), [size(Me67,1) 1]);
Me67 = 14.*(Me67-min67)./ (max67-min67);
Me67 = exp(Me67);
Me67(Me67==Inf) = NaN;
Me67(Me67==-Inf) = NaN;

MBlown67 = [Mg(:,[net_send Handler_update Innodb_os_log_fsyncs cpu_usr io_writ Com_commit Com_delete Com_update Innodb_data_fsyncs Innodb_pages_written Innodb_row_lock_time Innodb_rows_deleted Innodb_rows_inserted Innodb_rows_updated]) ...
    log(Mg(:, [io_writ Com_commit Com_delete Handler_delete Handler_update Innodb_log_writes Innodb_os_log_fsyncs Innodb_os_log_written Innodb_rows_deleted])) ...
    Me67 ...
    sigmf(Mg(:,[Com_commit Com_insert Com_update Handler_commit Handler_update Innodb_data_fsyncs Innodb_os_log_written Innodb_row_lock_time Innodb_rows_inserted Innodb_rows_read Innodb_rows_updated Table_locks_immediate]), [1 0]) ...
    ];

Blown67 = [CBlown67 MBlown67 Lg];

Blown67(Blown67==Inf) = NaN;
Blown67(Blown67==-Inf) = NaN;

Head67 = '"Tran1","Tran2","Tran3","Tran4","Tran5","Tran12","Tran13","Tran14","Tran15","Tran23","Tran24","Tran25","Tran34","Tran35","Tran45","net_send","Handler_update","Innodb_os_log_fsyncs","cpu_usr","io_writ","Com_commit","Com_delete","Com_update","Innodb_data_fsyncs","Innodb_pages_written","Innodb_row_lock_time","Innodb_rows_deleted","Innodb_rows_inserted","Innodb_rows_updated","lg_io_writ","lg_Com_commit","lg_Com_delete","lg_Handler_delete","lg_Handler_update","lg_Innodb_log_writes","lg_Innodb_os_log_fsyncs","lg_Innodb_os_log_written","lg_Innodb_rows_deleted","e_Com_commit","e_Com_update","e_Innodb_dblwr_pages_written","e_Innodb_pages_written","s_Com_commit","s_Com_insert","s_Com_update","s_Handler_commit","s_Handler_update","s_Innodb_data_fsyncs","s_Innodb_os_log_written","s_Innodb_row_lock_time","s_Innodb_rows_inserted","s_Innodb_rows_read","s_Innodb_rows_updated","s_Table_locks_immediate","Latency1"';
system(horzcat('echo ', Head67 ,' > /Users/sina/expr5/weka/Blown67.csv'));
dlmwrite('/Users/sina/expr5/weka/Blown67.csv',Blown67, 'delimiter',',','-append', 'precision', '%10.12f');        

CBlown27 = [ Cg ...
    Cg(:,1).*Cg(:,2) Cg(:,1).*Cg(:,3) Cg(:,1).*Cg(:,4) Cg(:,1).*Cg(:,5) ...
    Cg(:,2).*Cg(:,3) Cg(:,2).*Cg(:,4) Cg(:,2).*Cg(:,5) ...
    Cg(:,3).*Cg(:,4) Cg(:,3).*Cg(:,5) ...
    Cg(:,4).*Cg(:,5) ...
    ];

Me27 = Mg(:, [Com_commit Com_update]);
max27 = repmat(max(Me27), [size(Me27,1) 1]);
min27 = repmat(min(Me27), [size(Me27,1) 1]);
Me27 = 14.*(Me27-min27)./ (max27-min27);
Me27 = exp(Me27);
Me27(Me27==Inf) = NaN;
Me27(Me27==-Inf) = NaN;


MBlown27 = [Mg(:,[cpu_usr Com_commit Com_delete Com_update Innodb_data_fsyncs Innodb_pages_written Innodb_row_lock_time Innodb_rows_deleted Innodb_rows_inserted]) ...
    log(Mg(:, [Com_commit Com_delete Innodb_os_log_fsyncs Innodb_os_log_written])) ...
    Me27 ...
    sigmf(Mg(:, [Handler_update]), [1 0])];

Blown27 = [CBlown27 MBlown27 Lg];

Blown27(Blown27==Inf) = NaN;
Blown27(Blown27==-Inf) = NaN;

Head27 = '"Tran1","Tran2","Tran3","Tran4","Tran5","Tran12","Tran13","Tran14","Tran15","Tran23","Tran24","Tran25","Tran34","Tran35","Tran45","cpu_usr","Com_commit","Com_delete","Com_update","Innodb_data_fsyncs","Innodb_pages_written","Innodb_row_lock_time","Innodb_rows_deleted","Innodb_rows_inserted","lg_Com_commit","lg_Com_delete","lg_Innodb_os_log_fsyncs","lg_Innodb_os_log_written","e_Com_commit","e_Com_update","s_Handler_update","Latency1"';
system(horzcat('echo ', Head27 ,' > /Users/sina/expr5/weka/Blown27.csv'));
dlmwrite('/Users/sina/expr5/weka/Blown27.csv',Blown27, 'delimiter',',','-append', 'precision', '%10.12f');        

BlownNorm27 = Blown27;
BlownNorm27(BlownNorm27==Inf) = NaN;
BlownNorm27(BlownNorm27==-Inf) = NaN;
maxB = repmat(max(BlownNorm27), [size(BlownNorm27,1) 1]);
minB = repmat(min(BlownNorm27), [size(BlownNorm27,1) 1]);
BlownNorm27 = (BlownNorm27-minB)./ (maxB-minB);

system(horzcat('echo ', Head27 ,' > /Users/sina/expr5/weka/Blown27norm.csv'));
dlmwrite('/Users/sina/expr5/weka/Blown27norm.csv',BlownNorm27, 'delimiter',',','-append', 'precision', '%10.12f');        


